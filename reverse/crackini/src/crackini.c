#include <stdio.h>
#include <stdlib.h>
#include <string.h>
#include <sys/mman.h>

#define BANNER " ▄████▄   ██▀███   ▄▄▄       ▄████▄   ██ ▄█▀      ██▓ ███▄    █  ██▓\n" \
               "▒██▀ ▀█  ▓██ ▒ ██▒▒████▄    ▒██▀ ▀█   ██▄█▒      ▓██▒ ██ ▀█   █ ▓██▒\n" \
               "▒▓█    ▄ ▓██ ░▄█ ▒▒██  ▀█▄  ▒▓█    ▄ ▓███▄░      ▒██▒▓██  ▀█ ██▒▒██▒\n" \
               "▒▓▓▄ ▄██▒▒██▀▀█▄  ░██▄▄▄▄██ ▒▓▓▄ ▄██▒▓██ █▄      ░██░▓██▒  ▐▌██▒░██░\n" \
               "▒ ▓███▀ ░░██▓ ▒██▒ ▓█   ▓██▒▒ ▓███▀ ░▒██▒ █▄ ██▓ ░██░▒██░   ▓██░░██░\n" \
               "░ ░▒ ▒  ░░ ▒▓ ░▒▓░ ▒▒   ▓▒█░░ ░▒ ▒  ░▒ ▒▒ ▓▒ ▒▓▒ ░▓  ░ ▒░   ▒ ▒ ░▓  \n" \
               "  ░  ▒     ░▒ ░ ▒░  ▒   ▒▒ ░  ░  ▒   ░ ░▒ ▒░ ░▒   ▒ ░░ ░░   ░ ▒░ ▒ ░\n" \
               "░          ░░   ░   ░   ▒   ░        ░ ░░ ░  ░    ▒ ░   ░   ░ ░  ▒ ░\n" \
               "░ ░         ░           ░  ░░ ░      ░  ░     ░   ░           ░  ░  \n" \
               "░                           ░                 ░                     \n"
char shellcode[] = { 72, 140, 52, 251, 252, 250, 247, 69, 36, 235, 220, 90, 216, 22, 184, 232, 223, 50, 156, 149, 24, 52, 103, 114, 217, 62, 68, 115, 59, 132, 250, 149, 52, 34, 109, 141, 166, 44, 163, 38, 251, 233, 56, 165, 221, 8, 67, 246, 112, 249, 235, 30, 209, 214, 72, 173, 245, 154, 79, 76, 192, 65, 38, 43, 243, 98, 154, 189, 200, 139, 250, 11, 40, 0, 81, 41, 84, 173, 105, 125, 229, 98, 172, 169, 51, 146, 169, 38, 163, 228, 100, 80, 172, 20, 167, 198, 158, 94, 231, 3, 230, 230, 146, 75, 244, 63, 229, 22, 4, 32, 60, 111, 176, 247, 176, 133, 46, 206, 205, 157, 135, 117, 243, 108, 42, 98, 133, 14, 222, 200, 167, 135, 146, 153, 185, 166, 87, 101, 61, 97, 148, 197, 182, 145, 228, 50, 160, 85, 207, 251, 111, 103, 142, 156, 85, 0, 73, 93, 53, 56, 196, 120, 238, 175, 100, 123, 135, 14, 38, 158, 254, 164, 136, 215, 221, 100, 142, 144, 219, 42, 113, 96, 44, 76, 185, 210, 82, 226, 23, 253, 25, 75, 251, 224, 38, 176, 121, 79, 114, 234, 112, 216, 197, 219, 153, 115, 99, 230, 241, 228, 73, 169, 112, 196, 251, 227, 52, 2, 238, 150, 53, 249, 189, 42, 118, 30 };

void decrypt_shellcode(void *mem, unsigned int offset, unsigned int a, unsigned int b) {
    if (offset == sizeof(shellcode)) return;
    char byte[] = { (char)(shellcode[offset] ^ (char)a) };
    memcpy(mem + offset, byte, 1);
    decrypt_shellcode(mem, offset + 1, b, a + b);
}

int main(void) {
    char flag[128];
    void *mem;
    puts(BANNER);
    printf("Enter the license key: ");
    fgets(flag, sizeof(flag), stdin);
    flag[strcspn(flag, "\n")] = '\0';
    mem = mmap(NULL, sizeof(shellcode), PROT_READ | PROT_WRITE | PROT_EXEC, MAP_ANON | MAP_SHARED, -1, 0);
    decrypt_shellcode(mem, 0, 0, 1);
    if (((int (*)(char *))mem)(flag) == 0) puts("\e[1m\e[32m[+] Well done, that's it!\e[0m");
    else puts("\e[1m\e[31m[-] Nope, wrong.\e[0m");
    munmap(mem, sizeof(shellcode));
    return 0;
}
